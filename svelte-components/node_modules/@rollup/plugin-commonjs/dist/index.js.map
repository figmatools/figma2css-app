{"version":3,"file":"index.js","sources":["../src/helpers.js","../src/is-cjs.js","../src/resolve-id.js","../src/ast-utils.js","../src/utils.js","../src/transform.js","../src/index.js"],"sourcesContent":["export const PROXY_SUFFIX = '?commonjs-proxy';\nexport const getProxyId = (id) => `\\0${id}${PROXY_SUFFIX}`;\nexport const getIdFromProxyId = (proxyId) => proxyId.slice(1, -PROXY_SUFFIX.length);\n\nexport const EXTERNAL_SUFFIX = '?commonjs-external';\nexport const getExternalProxyId = (id) => `\\0${id}${EXTERNAL_SUFFIX}`;\nexport const getIdFromExternalProxyId = (proxyId) => proxyId.slice(1, -EXTERNAL_SUFFIX.length);\n\nexport const HELPERS_ID = '\\0commonjsHelpers.js';\n\n// `x['default']` is used instead of `x.default` for backward compatibility with ES3 browsers.\n// Minifiers like uglify will usually transpile it back if compatibility with ES3 is not enabled.\nexport const HELPERS = `\nexport var commonjsGlobal = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};\n\nexport function commonjsRequire () {\n\tthrow new Error('Dynamic requires are not currently supported by @rollup/plugin-commonjs');\n}\n\nexport function unwrapExports (x) {\n\treturn x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;\n}\n\nexport function createCommonjsModule(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\nexport function getCjsExportFromNamespace (n) {\n\treturn n && n['default'] || n;\n}`;\n","/* eslint-disable no-undefined */\nconst isCjsPromises = new Map();\n\nexport function getIsCjsPromise(id) {\n  let isCjsPromise = isCjsPromises.get(id);\n  if (isCjsPromise) return isCjsPromise.promise;\n\n  const promise = new Promise((resolve) => {\n    isCjsPromise = {\n      resolve,\n      promise: undefined\n    };\n    isCjsPromises.set(id, isCjsPromise);\n  });\n  isCjsPromise.promise = promise;\n\n  return promise;\n}\n\nexport function setIsCjsPromise(id, resolution) {\n  const isCjsPromise = isCjsPromises.get(id);\n  if (isCjsPromise) {\n    if (isCjsPromise.resolve) {\n      isCjsPromise.resolve(resolution);\n      isCjsPromise.resolve = undefined;\n    }\n  } else {\n    isCjsPromises.set(id, { promise: Promise.resolve(resolution), resolve: undefined });\n  }\n}\n","/* eslint-disable no-param-reassign, no-undefined */\nimport { statSync } from 'fs';\nimport { dirname, resolve, sep } from 'path';\n\nimport {\n  getExternalProxyId,\n  getIdFromProxyId,\n  getProxyId,\n  HELPERS_ID,\n  PROXY_SUFFIX\n} from './helpers';\n\nfunction getCandidatesForExtension(resolved, extension) {\n  return [resolved + extension, `${resolved}${sep}index${extension}`];\n}\n\nfunction getCandidates(resolved, extensions) {\n  return extensions.reduce(\n    (paths, extension) => paths.concat(getCandidatesForExtension(resolved, extension)),\n    [resolved]\n  );\n}\n\nexport default function getResolveId(extensions) {\n  function resolveExtensions(importee, importer) {\n    // not our problem\n    if (importee[0] !== '.' || !importer) return undefined;\n\n    const resolved = resolve(dirname(importer), importee);\n    const candidates = getCandidates(resolved, extensions);\n\n    for (let i = 0; i < candidates.length; i += 1) {\n      try {\n        const stats = statSync(candidates[i]);\n        if (stats.isFile()) return { id: candidates[i] };\n      } catch (err) {\n        /* noop */\n      }\n    }\n\n    return undefined;\n  }\n\n  function resolveId(importee, importer) {\n    const isProxyModule = importee.endsWith(PROXY_SUFFIX);\n    if (isProxyModule) {\n      importee = getIdFromProxyId(importee);\n    } else if (importee.startsWith('\\0')) {\n      if (importee === HELPERS_ID) {\n        return importee;\n      }\n      return null;\n    }\n\n    if (importer && importer.endsWith(PROXY_SUFFIX)) {\n      importer = getIdFromProxyId(importer);\n    }\n\n    return this.resolve(importee, importer, { skipSelf: true }).then((resolved) => {\n      if (!resolved) {\n        resolved = resolveExtensions(importee, importer);\n      }\n      if (isProxyModule) {\n        if (!resolved) {\n          return { id: getExternalProxyId(importee), external: false };\n        }\n        resolved.id = (resolved.external ? getExternalProxyId : getProxyId)(resolved.id);\n        resolved.external = false;\n        return resolved;\n      }\n      return resolved;\n    });\n  }\n\n  return resolveId;\n}\n","/* eslint-disable no-undefined */\nexport { default as isReference } from 'is-reference';\n\nconst operators = {\n  '==': (x) => equals(x.left, x.right, false),\n\n  '!=': (x) => not(operators['=='](x)),\n\n  '===': (x) => equals(x.left, x.right, true),\n\n  '!==': (x) => not(operators['==='](x)),\n\n  '!': (x) => isFalsy(x.argument),\n\n  '&&': (x) => isTruthy(x.left) && isTruthy(x.right),\n\n  '||': (x) => isTruthy(x.left) || isTruthy(x.right)\n};\n\nconst extractors = {\n  Identifier(names, node) {\n    names.push(node.name);\n  },\n\n  ObjectPattern(names, node) {\n    node.properties.forEach((prop) => {\n      getExtractor(prop.value.type)(names, prop.value);\n    });\n  },\n\n  ArrayPattern(names, node) {\n    node.elements.forEach((element) => {\n      if (!element) return;\n      getExtractor(element.type)(names, element);\n    });\n  },\n\n  RestElement(names, node) {\n    getExtractor(node.argument.type)(names, node.argument);\n  },\n\n  AssignmentPattern(names, node) {\n    getExtractor(node.left.type)(names, node.left);\n  }\n};\n\nexport function flatten(node) {\n  const parts = [];\n\n  while (node.type === 'MemberExpression') {\n    if (node.computed) return null;\n\n    parts.unshift(node.property.name);\n    // eslint-disable-next-line no-param-reassign\n    node = node.object;\n  }\n\n  if (node.type !== 'Identifier') return null;\n\n  const { name } = node;\n  parts.unshift(name);\n\n  return { name, keypath: parts.join('.') };\n}\n\nexport function extractNames(node) {\n  const names = [];\n  extractors[node.type](names, node);\n  return names;\n}\n\nfunction getExtractor(type) {\n  const extractor = extractors[type];\n  if (!extractor) throw new SyntaxError(`${type} pattern not supported.`);\n  return extractor;\n}\n\nexport function isTruthy(node) {\n  if (node.type === 'Literal') return !!node.value;\n  if (node.type === 'ParenthesizedExpression') return isTruthy(node.expression);\n  if (node.operator in operators) return operators[node.operator](node);\n  return undefined;\n}\n\nexport function isFalsy(node) {\n  return not(isTruthy(node));\n}\n\nfunction not(value) {\n  return value === undefined ? value : !value;\n}\n\nfunction equals(a, b, strict) {\n  if (a.type !== b.type) return undefined;\n  // eslint-disable-next-line eqeqeq\n  if (a.type === 'Literal') return strict ? a.value === b.value : a.value == b.value;\n  return undefined;\n}\n","/* eslint-disable import/prefer-default-export */\nimport { basename, dirname, extname, sep } from 'path';\n\nimport { makeLegalIdentifier } from '@rollup/pluginutils';\n\nexport function getName(id) {\n  const name = makeLegalIdentifier(basename(id, extname(id)));\n  if (name !== 'index') {\n    return name;\n  }\n  const segments = dirname(id).split(sep);\n  return makeLegalIdentifier(segments[segments.length - 1]);\n}\n","/* eslint-disable no-param-reassign, no-shadow, no-underscore-dangle */\nimport { walk } from 'estree-walker';\nimport MagicString from 'magic-string';\nimport { attachScopes, extractAssignedNames, makeLegalIdentifier } from '@rollup/pluginutils';\n\nimport { flatten, isFalsy, isReference, isTruthy } from './ast-utils';\nimport { getProxyId, HELPERS_ID } from './helpers';\nimport { getName } from './utils';\n\nconst reserved = 'process location abstract arguments boolean break byte case catch char class const continue debugger default delete do double else enum eval export extends false final finally float for from function goto if implements import in instanceof int interface let long native new null package private protected public return short static super switch synchronized this throw throws transient true try typeof var void volatile while with yield'.split(\n  ' '\n);\nconst blacklist = { __esModule: true };\nreserved.forEach((word) => (blacklist[word] = true));\n\nconst exportsPattern = /^(?:module\\.)?exports(?:\\.([a-zA-Z_$][a-zA-Z_$0-9]*))?$/;\n\nconst firstpassGlobal = /\\b(?:require|module|exports|global)\\b/;\nconst firstpassNoGlobal = /\\b(?:require|module|exports)\\b/;\nconst importExportDeclaration = /^(?:Import|Export(?:Named|Default))Declaration/;\nconst functionType = /^(?:FunctionDeclaration|FunctionExpression|ArrowFunctionExpression)$/;\n\nfunction deconflict(scope, globals, identifier) {\n  let i = 1;\n  let deconflicted = identifier;\n\n  while (scope.contains(deconflicted) || globals.has(deconflicted) || deconflicted in blacklist) {\n    deconflicted = `${identifier}_${i}`;\n    i += 1;\n  }\n  scope.declarations[deconflicted] = true;\n\n  return deconflicted;\n}\n\nfunction tryParse(parse, code, id) {\n  try {\n    return parse(code, { allowReturnOutsideFunction: true });\n  } catch (err) {\n    err.message += ` in ${id}`;\n    throw err;\n  }\n}\n\nexport function hasCjsKeywords(code, ignoreGlobal) {\n  const firstpass = ignoreGlobal ? firstpassNoGlobal : firstpassGlobal;\n  return firstpass.test(code);\n}\n\nexport function checkEsModule(parse, code, id) {\n  const ast = tryParse(parse, code, id);\n\n  let isEsModule = false;\n  for (const node of ast.body) {\n    if (node.type === 'ExportDefaultDeclaration')\n      return { isEsModule: true, hasDefaultExport: true, ast };\n    if (node.type === 'ExportNamedDeclaration') {\n      isEsModule = true;\n      for (const specifier of node.specifiers) {\n        if (specifier.exported.name === 'default') {\n          return { isEsModule: true, hasDefaultExport: true, ast };\n        }\n      }\n    } else if (importExportDeclaration.test(node.type)) isEsModule = true;\n  }\n\n  return { isEsModule, hasDefaultExport: false, ast };\n}\n\nexport function transformCommonjs(\n  parse,\n  code,\n  id,\n  isEntry,\n  ignoreGlobal,\n  ignoreRequire,\n  customNamedExports,\n  sourceMap,\n  allowDynamicRequire,\n  astCache\n) {\n  const ast = astCache || tryParse(parse, code, id);\n\n  const magicString = new MagicString(code);\n\n  const required = {};\n  // Because objects have no guaranteed ordering, yet we need it,\n  // we need to keep track of the order in a array\n  const sources = [];\n\n  let uid = 0;\n\n  let scope = attachScopes(ast, 'scope');\n  const uses = { module: false, exports: false, global: false, require: false };\n\n  let lexicalDepth = 0;\n  let programDepth = 0;\n\n  const globals = new Set();\n\n  // TODO technically wrong since globals isn't populated yet, but ¯\\_(ツ)_/¯\n  const HELPERS_NAME = deconflict(scope, globals, 'commonjsHelpers');\n\n  const namedExports = {};\n\n  // TODO handle transpiled modules\n  let shouldWrap = /__esModule/.test(code);\n\n  function isRequireStatement(node) {\n    if (!node) return false;\n    if (node.type !== 'CallExpression') return false;\n    if (node.callee.name !== 'require' || scope.contains('require')) return false;\n    // Weird case of require() without arguments\n    if (node.arguments.length === 0) return false;\n    return true;\n  }\n\n  function hasDynamicArguments(node) {\n    return (\n      node.arguments.length > 1 ||\n      (node.arguments[0].type !== 'Literal' &&\n        (node.arguments[0].type !== 'TemplateLiteral' || node.arguments[0].expressions.length > 0))\n    );\n  }\n\n  function isStaticRequireStatement(node) {\n    if (!isRequireStatement(node)) return false;\n    if (hasDynamicArguments(node)) return false;\n    if (ignoreRequire(node.arguments[0].value)) return false;\n    return true;\n  }\n\n  function getRequireStringArg(node) {\n    return node.arguments[0].type === 'Literal'\n      ? node.arguments[0].value\n      : node.arguments[0].quasis[0].value.cooked;\n  }\n\n  function getRequired(node, name) {\n    const sourceId = getRequireStringArg(node);\n    const existing = required[sourceId];\n    // eslint-disable-next-line no-undefined\n    if (existing === undefined) {\n      if (!name) {\n        do {\n          name = `require$$${uid}`;\n          uid += 1;\n        } while (scope.contains(name));\n      }\n\n      sources.push(sourceId);\n      required[sourceId] = { source: sourceId, name, importsDefault: false };\n    }\n\n    return required[sourceId];\n  }\n\n  // do a first pass, see which names are assigned to. This is necessary to prevent\n  // illegally replacing `var foo = require('foo')` with `import foo from 'foo'`,\n  // where `foo` is later reassigned. (This happens in the wild. CommonJS, sigh)\n  const assignedTo = new Set();\n  walk(ast, {\n    enter(node) {\n      if (node.type !== 'AssignmentExpression') return;\n      if (node.left.type === 'MemberExpression') return;\n\n      extractAssignedNames(node.left).forEach((name) => {\n        assignedTo.add(name);\n      });\n    }\n  });\n\n  walk(ast, {\n    enter(node, parent) {\n      if (sourceMap) {\n        magicString.addSourcemapLocation(node.start);\n        magicString.addSourcemapLocation(node.end);\n      }\n\n      // skip dead branches\n      if (parent && (parent.type === 'IfStatement' || parent.type === 'ConditionalExpression')) {\n        if (node === parent.consequent && isFalsy(parent.test)) {\n          this.skip();\n          return;\n        }\n        if (node === parent.alternate && isTruthy(parent.test)) {\n          this.skip();\n          return;\n        }\n      }\n\n      if (node._skip) {\n        this.skip();\n        return;\n      }\n\n      programDepth += 1;\n\n      if (node.scope) ({ scope } = node);\n      if (functionType.test(node.type)) lexicalDepth += 1;\n\n      // if toplevel return, we need to wrap it\n      if (node.type === 'ReturnStatement' && lexicalDepth === 0) {\n        shouldWrap = true;\n      }\n\n      // rewrite `this` as `commonjsHelpers.commonjsGlobal`\n      if (node.type === 'ThisExpression' && lexicalDepth === 0) {\n        uses.global = true;\n        if (!ignoreGlobal)\n          magicString.overwrite(node.start, node.end, `${HELPERS_NAME}.commonjsGlobal`, {\n            storeName: true\n          });\n        return;\n      }\n\n      // rewrite `typeof module`, `typeof module.exports` and `typeof exports` (https://github.com/rollup/rollup-plugin-commonjs/issues/151)\n      if (node.type === 'UnaryExpression' && node.operator === 'typeof') {\n        const flattened = flatten(node.argument);\n        if (!flattened) return;\n\n        if (scope.contains(flattened.name)) return;\n\n        if (\n          flattened.keypath === 'module.exports' ||\n          flattened.keypath === 'module' ||\n          flattened.keypath === 'exports'\n        ) {\n          magicString.overwrite(node.start, node.end, `'object'`, { storeName: false });\n        }\n      }\n\n      // rewrite `require` (if not already handled) `global` and `define`, and handle free references to\n      // `module` and `exports` as these mean we need to wrap the module in commonjsHelpers.createCommonjsModule\n      if (node.type === 'Identifier') {\n        if (isReference(node, parent) && !scope.contains(node.name)) {\n          if (node.name in uses) {\n            if (node.name === 'require') {\n              if (allowDynamicRequire) return;\n              magicString.overwrite(node.start, node.end, `${HELPERS_NAME}.commonjsRequire`, {\n                storeName: true\n              });\n            }\n\n            uses[node.name] = true;\n            if (node.name === 'global' && !ignoreGlobal) {\n              magicString.overwrite(node.start, node.end, `${HELPERS_NAME}.commonjsGlobal`, {\n                storeName: true\n              });\n            }\n\n            // if module or exports are used outside the context of an assignment\n            // expression, we need to wrap the module\n            if (node.name === 'module' || node.name === 'exports') {\n              shouldWrap = true;\n            }\n          }\n\n          if (node.name === 'define') {\n            magicString.overwrite(node.start, node.end, 'undefined', { storeName: true });\n          }\n\n          globals.add(node.name);\n        }\n\n        return;\n      }\n\n      // Is this an assignment to exports or module.exports?\n      if (node.type === 'AssignmentExpression') {\n        if (node.left.type !== 'MemberExpression') return;\n\n        const flattened = flatten(node.left);\n        if (!flattened) return;\n\n        if (scope.contains(flattened.name)) return;\n\n        const match = exportsPattern.exec(flattened.keypath);\n        if (!match || flattened.keypath === 'exports') return;\n\n        uses[flattened.name] = true;\n\n        // we're dealing with `module.exports = ...` or `[module.]exports.foo = ...` –\n        // if this isn't top-level, we'll need to wrap the module\n        if (programDepth > 3) shouldWrap = true;\n\n        node.left._skip = true;\n\n        if (flattened.keypath === 'module.exports' && node.right.type === 'ObjectExpression') {\n          node.right.properties.forEach((prop) => {\n            if (prop.computed || !('key' in prop) || prop.key.type !== 'Identifier') return;\n            const { name } = prop.key;\n            if (name === makeLegalIdentifier(name)) namedExports[name] = true;\n          });\n          return;\n        }\n\n        if (match[1]) namedExports[match[1]] = true;\n        return;\n      }\n\n      // if this is `var x = require('x')`, we can do `import x from 'x'`\n      if (\n        node.type === 'VariableDeclarator' &&\n        node.id.type === 'Identifier' &&\n        isStaticRequireStatement(node.init)\n      ) {\n        // for now, only do this for top-level requires. maybe fix this in future\n        if (scope.parent) return;\n\n        // edge case — CJS allows you to assign to imports. ES doesn't\n        if (assignedTo.has(node.id.name)) return;\n\n        const required = getRequired(node.init, node.id.name);\n        required.importsDefault = true;\n\n        if (required.name === node.id.name) {\n          node._shouldRemove = true;\n        }\n      }\n\n      if (!isStaticRequireStatement(node)) return;\n\n      const required = getRequired(node);\n\n      if (parent.type === 'ExpressionStatement') {\n        // is a bare import, e.g. `require('foo');`\n        magicString.remove(parent.start, parent.end);\n      } else {\n        required.importsDefault = true;\n        magicString.overwrite(node.start, node.end, required.name);\n      }\n\n      node.callee._skip = true;\n    },\n\n    leave(node) {\n      programDepth -= 1;\n      if (node.scope) scope = scope.parent;\n      if (functionType.test(node.type)) lexicalDepth -= 1;\n\n      if (node.type === 'VariableDeclaration') {\n        let keepDeclaration = false;\n        let c = node.declarations[0].start;\n\n        for (let i = 0; i < node.declarations.length; i += 1) {\n          const declarator = node.declarations[i];\n\n          if (declarator._shouldRemove) {\n            magicString.remove(c, declarator.end);\n          } else {\n            if (!keepDeclaration) {\n              magicString.remove(c, declarator.start);\n              keepDeclaration = true;\n            }\n\n            c = declarator.end;\n          }\n        }\n\n        if (!keepDeclaration) {\n          magicString.remove(node.start, node.end);\n        }\n      }\n    }\n  });\n\n  if (\n    !sources.length &&\n    !uses.module &&\n    !uses.exports &&\n    !uses.require &&\n    (ignoreGlobal || !uses.global)\n  ) {\n    if (Object.keys(namedExports).length) {\n      throw new Error(\n        `Custom named exports were specified for ${id} but it does not appear to be a CommonJS module`\n      );\n    }\n    // not a CommonJS module\n    return null;\n  }\n\n  const includeHelpers = shouldWrap || uses.global || uses.require;\n  const importBlock = `${(includeHelpers\n    ? [`import * as ${HELPERS_NAME} from '${HELPERS_ID}';`]\n    : []\n  )\n    .concat(\n      sources.map(\n        (source) =>\n          // import the actual module before the proxy, so that we know\n          // what kind of proxy to build\n          `import '${source}';`\n      ),\n      sources.map((source) => {\n        const { name, importsDefault } = required[source];\n        return `import ${importsDefault ? `${name} from ` : ``}'${getProxyId(source)}';`;\n      })\n    )\n    .join('\\n')}\\n\\n`;\n\n  const namedExportDeclarations = [];\n  let wrapperStart = '';\n  let wrapperEnd = '';\n\n  const moduleName = deconflict(scope, globals, getName(id));\n  if (!isEntry) {\n    const exportModuleExports = {\n      str: `export { ${moduleName} as __moduleExports };`,\n      name: '__moduleExports'\n    };\n\n    namedExportDeclarations.push(exportModuleExports);\n  }\n\n  const name = getName(id);\n\n  function addExport(x) {\n    const deconflicted = deconflict(scope, globals, name);\n\n    const declaration =\n      deconflicted === name\n        ? `export var ${x} = ${moduleName}.${x};`\n        : `var ${deconflicted} = ${moduleName}.${x};\\nexport { ${deconflicted} as ${x} };`;\n\n    namedExportDeclarations.push({\n      str: declaration,\n      name: x\n    });\n  }\n\n  if (customNamedExports) customNamedExports.forEach(addExport);\n\n  const defaultExportPropertyAssignments = [];\n  let hasDefaultExport = false;\n\n  if (shouldWrap) {\n    const args = `module${uses.exports ? ', exports' : ''}`;\n\n    wrapperStart = `var ${moduleName} = ${HELPERS_NAME}.createCommonjsModule(function (${args}) {\\n`;\n    wrapperEnd = `\\n});`;\n  } else {\n    const names = [];\n\n    ast.body.forEach((node) => {\n      if (node.type === 'ExpressionStatement' && node.expression.type === 'AssignmentExpression') {\n        const { left } = node.expression;\n        const flattened = flatten(left);\n\n        if (!flattened) return;\n\n        const match = exportsPattern.exec(flattened.keypath);\n        if (!match) return;\n\n        if (flattened.keypath === 'module.exports') {\n          hasDefaultExport = true;\n          magicString.overwrite(left.start, left.end, `var ${moduleName}`);\n        } else {\n          const [, name] = match;\n          const deconflicted = deconflict(scope, globals, name);\n\n          names.push({ name, deconflicted });\n\n          magicString.overwrite(node.start, left.end, `var ${deconflicted}`);\n\n          const declaration =\n            name === deconflicted\n              ? `export { ${name} };`\n              : `export { ${deconflicted} as ${name} };`;\n\n          if (name !== 'default') {\n            namedExportDeclarations.push({\n              str: declaration,\n              name\n            });\n            delete namedExports[name];\n          }\n\n          defaultExportPropertyAssignments.push(`${moduleName}.${name} = ${deconflicted};`);\n        }\n      }\n    });\n\n    if (!hasDefaultExport && (names.length || !isEntry)) {\n      wrapperEnd = `\\n\\nvar ${moduleName} = {\\n${names\n        .map(({ name, deconflicted }) => `\\t${name}: ${deconflicted}`)\n        .join(',\\n')}\\n};`;\n    }\n  }\n  Object.keys(namedExports)\n    .filter((key) => !blacklist[key])\n    .forEach(addExport);\n\n  const defaultExport = /__esModule/.test(code)\n    ? `export default ${HELPERS_NAME}.unwrapExports(${moduleName});`\n    : `export default ${moduleName};`;\n\n  const named = namedExportDeclarations\n    .filter((x) => x.name !== 'default' || !hasDefaultExport)\n    .map((x) => x.str);\n\n  const exportBlock = `\\n\\n${[defaultExport]\n    .concat(named)\n    .concat(hasDefaultExport ? defaultExportPropertyAssignments : [])\n    .join('\\n')}`;\n\n  magicString\n    .trim()\n    .prepend(importBlock + wrapperStart)\n    .trim()\n    .append(wrapperEnd);\n\n  if (hasDefaultExport || named.length > 0 || shouldWrap || !isEntry) {\n    magicString.append(exportBlock);\n  }\n\n  code = magicString.toString();\n  const map = sourceMap ? magicString.generateMap() : null;\n\n  return { code, map };\n}\n","import { realpathSync, existsSync } from 'fs';\nimport { extname, resolve, normalize } from 'path';\n\nimport { sync as nodeResolveSync, isCore } from 'resolve';\nimport { createFilter } from '@rollup/pluginutils';\n\nimport { peerDependencies } from '../package.json';\n\nimport {\n  EXTERNAL_SUFFIX,\n  getIdFromExternalProxyId,\n  getIdFromProxyId,\n  HELPERS,\n  HELPERS_ID,\n  PROXY_SUFFIX\n} from './helpers';\nimport { getIsCjsPromise, setIsCjsPromise } from './is-cjs';\nimport getResolveId from './resolve-id';\nimport { checkEsModule, hasCjsKeywords, transformCommonjs } from './transform';\nimport { getName } from './utils';\n\nexport default function commonjs(options = {}) {\n  const extensions = options.extensions || ['.js'];\n  const filter = createFilter(options.include, options.exclude);\n  const { ignoreGlobal } = options;\n\n  const customNamedExports = {};\n  if (options.namedExports) {\n    Object.keys(options.namedExports).forEach((id) => {\n      let resolveId = id;\n      let resolvedId;\n\n      if (isCore(id)) {\n        // resolve will not find npm modules with the same name as\n        // core modules without a trailing slash. Since core modules\n        // must be external, we can assume any core modules defined\n        // here are npm modules by that name.\n        resolveId += '/';\n      }\n\n      try {\n        resolvedId = nodeResolveSync(resolveId, { basedir: process.cwd() });\n      } catch (err) {\n        resolvedId = resolve(id);\n      }\n\n      // Note: customNamedExport's keys must be normalized file paths.\n      // resolve and nodeResolveSync both return normalized file paths\n      // so no additional normalization is necessary.\n      customNamedExports[resolvedId] = options.namedExports[id];\n\n      if (existsSync(resolvedId)) {\n        const realpath = realpathSync(resolvedId);\n        if (realpath !== resolvedId) {\n          customNamedExports[realpath] = options.namedExports[id];\n        }\n      }\n    });\n  }\n\n  const esModulesWithoutDefaultExport = new Set();\n  const esModulesWithDefaultExport = new Set();\n  // TODO maybe this should be configurable?\n  const allowDynamicRequire = !!options.ignore;\n\n  const ignoreRequire =\n    typeof options.ignore === 'function'\n      ? options.ignore\n      : Array.isArray(options.ignore)\n      ? (id) => options.ignore.includes(id)\n      : () => false;\n\n  const resolveId = getResolveId(extensions);\n\n  const sourceMap = options.sourceMap !== false;\n\n  function transformAndCheckExports(code, id) {\n    const { isEsModule, hasDefaultExport, ast } = checkEsModule(this.parse, code, id);\n    if (isEsModule) {\n      (hasDefaultExport ? esModulesWithDefaultExport : esModulesWithoutDefaultExport).add(id);\n      return null;\n    }\n\n    // it is not an ES module but it does not have CJS-specific elements.\n    if (!hasCjsKeywords(code, ignoreGlobal)) {\n      esModulesWithoutDefaultExport.add(id);\n      return null;\n    }\n\n    const normalizedId = normalize(id);\n\n    const transformed = transformCommonjs(\n      this.parse,\n      code,\n      id,\n      this.getModuleInfo(id).isEntry,\n      ignoreGlobal,\n      ignoreRequire,\n      customNamedExports[normalizedId],\n      sourceMap,\n      allowDynamicRequire,\n      ast\n    );\n    if (!transformed) {\n      esModulesWithoutDefaultExport.add(id);\n      return null;\n    }\n\n    return transformed;\n  }\n\n  return {\n    name: 'commonjs',\n\n    buildStart() {\n      const [major, minor] = this.meta.rollupVersion.split('.').map(Number);\n      const minVersion = peerDependencies.rollup.slice(2);\n      const [minMajor, minMinor] = minVersion.split('.').map(Number);\n      if (major < minMajor || (major === minMajor && minor < minMinor)) {\n        this.error(\n          `Insufficient Rollup version: \"@rollup/plugin-commonjs\" requires at least rollup@${minVersion} but found rollup@${this.meta.rollupVersion}.`\n        );\n      }\n    },\n\n    resolveId,\n\n    load(id) {\n      if (id === HELPERS_ID) return HELPERS;\n\n      // generate proxy modules\n      if (id.endsWith(EXTERNAL_SUFFIX)) {\n        const actualId = getIdFromExternalProxyId(id);\n        const name = getName(actualId);\n\n        return `import ${name} from ${JSON.stringify(actualId)}; export default ${name};`;\n      }\n\n      if (id.endsWith(PROXY_SUFFIX)) {\n        const actualId = getIdFromProxyId(id);\n        const name = getName(actualId);\n\n        return getIsCjsPromise(actualId).then((isCjs) => {\n          if (isCjs)\n            return `import { __moduleExports } from ${JSON.stringify(\n              actualId\n            )}; export default __moduleExports;`;\n          else if (esModulesWithoutDefaultExport.has(actualId))\n            return `import * as ${name} from ${JSON.stringify(actualId)}; export default ${name};`;\n          else if (esModulesWithDefaultExport.has(actualId)) {\n            return `export {default} from ${JSON.stringify(actualId)};`;\n          }\n          return `import * as ${name} from ${JSON.stringify(\n            actualId\n          )}; import {getCjsExportFromNamespace} from \"${HELPERS_ID}\"; export default getCjsExportFromNamespace(${name})`;\n        });\n      }\n\n      return null;\n    },\n\n    transform(code, id) {\n      if (!filter(id) || extensions.indexOf(extname(id)) === -1) {\n        setIsCjsPromise(id, null);\n        return null;\n      }\n\n      let transformed;\n      try {\n        transformed = transformAndCheckExports.call(this, code, id);\n      } catch (err) {\n        transformed = null;\n        this.error(err, err.loc);\n      }\n\n      setIsCjsPromise(id, Boolean(transformed));\n      return transformed;\n    }\n  };\n}\n"],"names":["PROXY_SUFFIX","getProxyId","id","getIdFromProxyId","proxyId","slice","length","EXTERNAL_SUFFIX","getExternalProxyId","getIdFromExternalProxyId","HELPERS_ID","HELPERS","isCjsPromises","Map","getIsCjsPromise","isCjsPromise","get","promise","Promise","resolve","undefined","set","setIsCjsPromise","resolution","getCandidatesForExtension","resolved","extension","sep","getCandidates","extensions","reduce","paths","concat","getResolveId","resolveExtensions","importee","importer","dirname","candidates","i","stats","statSync","isFile","err","resolveId","isProxyModule","endsWith","startsWith","skipSelf","then","external","operators","x","equals","left","right","not","isFalsy","argument","isTruthy","flatten","node","parts","type","computed","unshift","property","name","object","keypath","join","value","expression","operator","a","b","strict","getName","makeLegalIdentifier","basename","extname","segments","split","reserved","blacklist","__esModule","forEach","word","exportsPattern","firstpassGlobal","firstpassNoGlobal","importExportDeclaration","functionType","deconflict","scope","globals","identifier","deconflicted","contains","has","declarations","tryParse","parse","code","allowReturnOutsideFunction","message","hasCjsKeywords","ignoreGlobal","firstpass","test","checkEsModule","ast","isEsModule","body","hasDefaultExport","specifiers","specifier","exported","transformCommonjs","isEntry","ignoreRequire","customNamedExports","sourceMap","allowDynamicRequire","astCache","magicString","MagicString","required","sources","uid","attachScopes","uses","module","exports","global","require","lexicalDepth","programDepth","Set","HELPERS_NAME","namedExports","shouldWrap","isRequireStatement","callee","arguments","hasDynamicArguments","expressions","isStaticRequireStatement","getRequireStringArg","quasis","cooked","getRequired","sourceId","existing","push","source","importsDefault","assignedTo","walk","enter","extractAssignedNames","add","parent","addSourcemapLocation","start","end","consequent","skip","alternate","_skip","overwrite","storeName","flattened","isReference","match","exec","properties","prop","key","init","_shouldRemove","remove","leave","keepDeclaration","c","declarator","Object","keys","Error","includeHelpers","importBlock","map","namedExportDeclarations","wrapperStart","wrapperEnd","moduleName","exportModuleExports","str","addExport","declaration","defaultExportPropertyAssignments","args","names","filter","defaultExport","named","exportBlock","trim","prepend","append","toString","generateMap","commonjs","options","createFilter","include","exclude","resolvedId","isCore","nodeResolveSync","basedir","process","cwd","existsSync","realpath","realpathSync","esModulesWithoutDefaultExport","esModulesWithDefaultExport","ignore","Array","isArray","includes","transformAndCheckExports","normalizedId","normalize","transformed","getModuleInfo","buildStart","meta","rollupVersion","Number","major","minor","minVersion","peerDependencies","rollup","minMajor","minMinor","error","load","actualId","JSON","stringify","isCjs","transform","indexOf","call","loc","Boolean"],"mappings":"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"}